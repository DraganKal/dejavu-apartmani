<!DOCTYPE html>
<html lang="sr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin - Termini</title>
    <link rel="stylesheet" href="vendor/css/bundle.min.css" />
    <link rel="stylesheet" href="vendor/css/jquery-ui.bundle.css" />
    <link rel="stylesheet" href="portfolio-agency/css/style.css" />
    <style>
      .admin-card {
        max-width: 720px;
        margin: 40px auto;
        background: #fff;
        border: 1px solid #e2d7c9;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
      }
      .token-hint {
        font-size: 12px;
        opacity: 0.7;
      }
    </style>
  </head>
  <body>
    <div class="admin-card">
      <h3 class="mb-3">Upravljanje terminima</h3>
      <p class="token-hint">
        Unesite administratorski token (podesite ga u <code>config.php</code>).
      </p>
      <div class="form-group">
        <label>Admin token</label>
        <input
          id="adm-token"
          type="password"
          class="form-control"
          placeholder="ADMIN TOKEN"
        />
      </div>
      <div class="form-group">
        <label>Apartman</label>
        <select id="apt" class="form-control">
          <option value="dejavu1">DejaVu 1</option>
          <option value="dejavu2">DejaVu 2</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-group col-md-6">
          <label>Od datuma</label>
          <input id="start" type="date" class="form-control" />
        </div>
        <div class="form-group col-md-6">
          <label>Do datuma</label>
          <input id="end" type="date" class="form-control" />
        </div>
      </div>
      <div class="form-row">
        <div class="col-md-6 mb-2">
          <button id="add" class="btn btn-main btn-block">
            Dodaj zauzete dane
          </button>
        </div>
        <div class="col-md-6 mb-2">
          <button id="del" class="btn btn-main-inverse btn-block">
            Obriši zauzete dane
          </button>
        </div>
      </div>
      <div id="msg" class="mt-3"></div>
    </div>

    <div class="admin-card">
      <h3 class="mb-3">Cene</h3>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label>DejaVu 1 (EUR)</label>
            <input
              id="price-dejavu1-eur"
              type="number"
              min="0"
              step="0.01"
              class="form-control"
              placeholder="0.00"
            />
          </div>
          <div class="form-group">
            <label>DejaVu 1 (RSD)</label>
            <input
              id="price-dejavu1-rsd"
              type="number"
              min="0"
              step="0.01"
              class="form-control"
              placeholder="0.00"
            />
          </div>
          <button id="save-p1" class="btn btn-main btn-block mb-3">
            Snimi cenu DejaVu 1
          </button>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label>DejaVu 2 (EUR)</label>
            <input
              id="price-dejavu2-eur"
              type="number"
              min="0"
              step="0.01"
              class="form-control"
              placeholder="0.00"
            />
          </div>
          <div class="form-group">
            <label>DejaVu 2 (RSD)</label>
            <input
              id="price-dejavu2-rsd"
              type="number"
              min="0"
              step="0.01"
              class="form-control"
              placeholder="0.00"
            />
          </div>
          <button id="save-p2" class="btn btn-main btn-block mb-3">
            Snimi cenu DejaVu 2
          </button>
        </div>
      </div>
      <div id="msg-price" class="mt-3"></div>
    </div>

    <script src="vendor/js/bundle.min.js"></script>
    <script>
      function act(action) {
        var data = {
          token: document.getElementById("adm-token").value,
          apartment: document.getElementById("apt").value,
          start_date: document.getElementById("start").value,
          end_date: document.getElementById("end").value,
          action: action,
        };
        fetch("api/admin_save.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8",
          },
          body: new URLSearchParams(data).toString(),
        })
          .then((r) => r.json())
          .then(function (res) {
            var el = document.getElementById("msg");
            if (res && res.status === "ok") {
              el.innerHTML =
                '<div class="alert alert-success">Uspešno snimljeno.</div>';
            } else {
              el.innerHTML =
                '<div class="alert alert-danger">Greška: ' +
                (res && res.error ? res.error : "Nepoznata greška") +
                "</div>";
            }
          })
          .catch(function () {
            document.getElementById("msg").innerHTML =
              '<div class="alert alert-danger">Greška u komunikaciji.</div>';
          });
      }
      document.getElementById("add").addEventListener("click", function () {
        act("add");
      });
      document.getElementById("del").addEventListener("click", function () {
        act("delete");
      });

      function loadPrices() {
        fetch("api/prices.php")
          .then((r) => r.json())
          .then(function (res) {
            if (res && res.prices) {
              if (res.prices.dejavu1) {
                if (res.prices.dejavu1.eur != null)
                  document.getElementById("price-dejavu1-eur").value =
                    res.prices.dejavu1.eur;
                if (res.prices.dejavu1.rsd != null)
                  document.getElementById("price-dejavu1-rsd").value =
                    res.prices.dejavu1.rsd;
              }
              if (res.prices.dejavu2) {
                if (res.prices.dejavu2.eur != null)
                  document.getElementById("price-dejavu2-eur").value =
                    res.prices.dejavu2.eur;
                if (res.prices.dejavu2.rsd != null)
                  document.getElementById("price-dejavu2-rsd").value =
                    res.prices.dejavu2.rsd;
              }
            }
          });
      }
      function savePrice(apt, inputIdEur, inputIdRsd) {
        var data = {
          token: document.getElementById("adm-token").value,
          apartment: apt,
          price_eur: document.getElementById(inputIdEur).value,
          price_rsd: document.getElementById(inputIdRsd).value,
        };
        fetch("api/admin_prices.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8",
          },
          body: new URLSearchParams(data).toString(),
        })
          .then((r) => r.json())
          .then(function (res) {
            var el = document.getElementById("msg-price");
            if (res && res.status === "ok") {
              el.innerHTML =
                '<div class="alert alert-success">Cena snimljena.</div>';
            } else {
              el.innerHTML =
                '<div class="alert alert-danger">Greška: ' +
                (res && res.error ? res.error : "Nepoznata greška") +
                "</div>";
            }
          })
          .catch(function () {
            document.getElementById("msg-price").innerHTML =
              '<div class="alert alert-danger">Greška u komunikaciji.</div>';
          });
      }
      document.getElementById("save-p1").addEventListener("click", function () {
        savePrice("dejavu1", "price-dejavu1-eur", "price-dejavu1-rsd");
      });
      document.getElementById("save-p2").addEventListener("click", function () {
        savePrice("dejavu2", "price-dejavu2-eur", "price-dejavu2-rsd");
      });

      loadPrices();
    </script>
  </body>
</html>
